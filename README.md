# Synchrotron Imaging Processing Suite (SIPS)

SIPS as a UI based software to display and process large amounts of high-speed grayscale video data.
It can display all kinds of grayscale image stacks, as long as they are provided as a 3D numpy array or one of the
supported file formats.

The software was primarily developed to load and process *.cine* files, generated by VisionResearch Phantom high-speed
cameras and has been developed within Project *Track-AM - Real time tracking of electron beam-matter interactions*.
It has been predominantly used by myself for the processing and analysis of high-speed synchrotron imaging data and
comes with special functionality to deal with low quality and low contrast data set for information extraction.

## Data format
SIPS displays video data by reading it from a numpy array. Any data that is provided in the right numpy array structure
can be displayed. For *.cine* & *.tif* files, this conversion is already built-in. Data has to be provided in
grey-scale (no color images/videos). Arrays follow the structure:

- (x, y, z)
- x = image width
- y = image height
- z = image number

The image arrays should be provided as floats and not integers as SIPS performs divisions between pixel values that
are not possible with integers

# Getting started/installation

To use this project, clone it from this repository install the necessary packages (preferably within a virtual
environment). This project was tested to run on Python 3.11 and should run on higher versions as well. For lower
Python versions, slight modifications might be necessary. Then install the necessary packages by typing (from within
project directory):

``
pip install -r requirements.lock.txt
``

This will install the necessary packages to run the program. If you run into issues during installation, try the
following things:

- update pip to the newest version
- try to install *requirements.base.txt* instead (this only contains the imported packages and allows pip to select
dependencies itself)
- if this doesn't work, try to install packages in *requirements.base.txt* without enforcing version numbers (packages
might not be compatible with the code anymore)

## Special packages
In order to load image stacks directly from VisionResearch Phantom *.cine* files, the pycine package from *ottomatic-io*
is installed from *github*. While the package is also available on *pypi.org* (pycine version 0.3.2), this version is
outdated (at the time of this writing) and should not be used (due to compatibility with newest *.cine* file types).
The correct version should be installed automatically when running the requirements installation command. If that
should not work, try:

``
pip install git+https://github.com/ottomatic-io/pycine.git
``

Finally, if your *.cine* files were saved with P10L bit compression and you want properly displayed grey values (as
close to the *.tif* exports from VisionResearch's proprietary CineViewer software), you should go to *"pycine.raw"* into
the *"create_raw_array"* function and replace (not required):


- raw_image = linLUT[raw_image].astype(np.uint16)
- raw_image = np.interp(raw_image, [64, 4064], [0, 2 ** 12 - 1]).astype(np.uint16)

with 

- raw_image = linLUT[raw_image].astype(np.uint16) * 16

This will also improve loading speeds of P10L compressed *.cine* files into numpy arrays noticeably.

**Big thanks to ottomatic-io for developing and maintaining this project! Check the project out of you want access to
*.cine* file metadate and more.**

# Standalone UI
SIPS is a standalone program that comes with built-in file import and export functionality. While initiating SIPS as
a Python class offers some additional functionality (like loading non-supported file types into the UI with a custom
data conversion script), it is in most cases not necessary. To run SIPS without writing your own script, simply
execute the file *"start_SIPS.py"* within the run subdirectory of this project.

## UI scaling on different screens
SIPS was written in Tkinter and its widgets are supposed to automatically scale with window size. If you encounter UI
window or font size issues, use the *"sips_config.toml"* file where default window size and UI font scaling can be
manually adjusted and saved.

## Portable executable

To create a portable executable of this project, use pyinstaller by running the following command from within the run
subdirectory:

``
pyinstaller start_SIPS.py --onefile --windowed
``

This will create a single file executable (for the OS on which you executed the command). Make sure to store the
*"Startpage SIPS.tiff"*, the *"SIPS_icon.png"* and the *"sips_config.toml"* files within the same directory as the
executable, as they are required to initialize the program. SIPS is portable and can be run from a USB drive or any
other external drive.

*As of now, this method has only been tested on Windows and Linux devices, as I do not own a Mac to test it there.*

# Authorship, Use and Citation
This project is authored and maintained by **Nick Semjatov** (*nick.semjatov@freenet.de*).
If you want to use this project for your own work or research and have questions, feel free to contact me.

If you have used this project and found it useful for your own published work, please reference it in your work by
citing the following article:

*Publication follows*
